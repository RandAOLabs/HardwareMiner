# Technical Assumptions

## Repository Structure: Multi-repo
- **Mobile App Repository** - React Native codebase targeting iOS and Android
- **Orange Pi Software Repository** - Device-side setup and communication software

## Service Architecture
**Hybrid Architecture** - Mobile app (React Native) communicates with lightweight HTTP server running on Orange Pi devices. Mining software runs in Docker containers on the Pi devices. Each Orange Pi operates as an independent node with local API endpoints.

## Testing Requirements
**Unit + Integration** - Mobile app requires standard React Native testing. Orange Pi software needs local testing capabilities that don't require actual mining operations. Integration testing should validate app-to-device communication flows.

## Additional Technical Assumptions and Requests

**Mobile App Framework:**
- **React Native** - Single codebase building to both iOS and Android platforms
- Template assumed to handle dual-platform builds automatically
- WiFi scanning and network detection capabilities required

**Orange Pi Device Software:**
- **Lightweight HTTP server** - Provides REST endpoints for app communication
- **Docker-based mining software** - Containerized for easy management and status checking
- **Auto-restart capabilities** - Device can reset to setup mode on configuration failures
- **Status reporting system** - Device maintains and exposes current operational state

**Communication Protocol:**
- **HTTPS REST API** - Secure request/response using TLS with self-signed certificates
- **Device status endpoints** - Real-time status checking by mobile app
- **Local network only** - No internet required for app-device communication
- **Device discovery** - Orange Pi uses discoverable hostname pattern "RNG-Miner-XXXXXXXX" where XXXXXXXX is unique 8-character hardware-based device ID
- **Dynamic authentication** - User-set device password during initial setup, replacing hardcoded credentials
- **API rate limiting** - 30 requests/minute, 100/hour burst protection
- **Input validation** - Comprehensive sanitization of all user inputs and API parameters

**Orange Pi WiFi Module Capabilities (Orange Pi Zero 3):**
- **802.11ac dual-band** (2.4GHz + 5GHz) WiFi with Bluetooth 5.0
- **Hotspot creation** capability with configurable SSID hiding
- **DHCP server** functionality (192.168.12.0/24 default range)
- **Built-in pigtail antenna** for wireless connectivity

**Device States & Status Reporting:**
- **BOOT** - Initial device startup and configuration check
- **SETUP_MODE** - WiFi hotspot active, waiting for configuration
- **HOTSPOT_STARTING** - Initializing access point mode
- **HOTSPOT_ACTIVE** - Access point ready for app connection
- **CREDENTIALS_RECEIVED** - WiFi credentials received from app
- **HOTSPOT_TEARDOWN** - Gracefully disabling access point
- **CONNECTING** - Attempting to connect to provided WiFi credentials
- **CONNECT_RETRY** - Retrying failed WiFi connection (up to 3 attempts)
- **CONNECTED** - Successfully connected to home WiFi network
- **NETWORK_VALIDATION** - Verifying internet connectivity and API accessibility
- **OPERATIONAL** - Network confirmed, ready for mining configuration
- **MINING_READY** - Docker services running and mining operational
- **WIFI_FAILED** - WiFi connection failed, returning to setup mode
- **ERROR_RECOVERY** - Critical failure requiring manual intervention

**Device Monitoring Capabilities:**
- **WiFi connection status** - Connected/disconnected state
- **System metrics** - CPU, memory, disk usage (htop-style data)
- **Mining software status** - Docker container health and operational state
- **Network connectivity** - Internet access verification

**Mining Software Architecture:**
- **Repository:** https://github.com/RandAOLabs/Randomness-Provider.git (pre-cloned at /opt/mining/Randomness-Provider/)
- **Working Directory:** /opt/mining/Randomness-Provider/docker-compose/ subdirectory
- **Container Management:** Docker Compose with auto-restart policies (Docker & Docker Compose pre-installed)
- **Startup Command:** `docker compose up -d` executed from docker-compose directory
- **Docker Images:** Required images pre-pulled during repository cloning

**Required .env File Format:**
```
LOG_CONSOLE_LEVEL=3
SEED_PHRASE="[12-word seed phrase from user]"
WALLET_JSON='{
  "kty": "RSA",
  "e": "[generated_value]",
  "n": "[generated_value]",
  "d": "[generated_value]",
  "p": "[generated_value]",
  "q": "[generated_value]",
  "dp": "[generated_value]",
  "dq": "[generated_value]",
  "qi": "[generated_value]"
}'
PROVIDER_ID='[user_provided_or_generated]'
```

**Configuration Requirements:**
- **SEED_PHRASE:** Direct input from user's 12-word cryptocurrency wallet seed
- **WALLET_JSON:** RSA key components (generated by mobile app)
- **PROVIDER_ID:** Unique identifier (generated by mobile app)
- **DEVICE_ID:** 8-character hardware-based identifier (generated from MAC/serial)
- **LOG_CONSOLE_LEVEL:** Fixed at level 3 for operational logging

**WiFi State Machine Timing:**
- **Hotspot teardown timeout:** 30 seconds maximum
- **WiFi connection timeout:** 20 seconds per attempt
- **Connection retry delay:** 10 seconds between attempts
- **Network validation timeout:** 10 seconds for internet check
- **Total transition window:** 60 seconds for complete handoff

**Security Upgrade Path:**
- **V1.0:** HTTPS/TLS + user-set passwords + input validation + rate limiting
- **V1.1:** Dynamic device tokens + encrypted configuration storage
- **V1.2:** Certificate-based authentication + secure script execution
- **V2.0:** Full enterprise security with key rotation and audit logging
